public class CachedBicubicInterpolator
{
    private double a00, a01, a02, a03;
    private double a10, a11, a12, a13;
    private double a20, a21, a22, a23;
    private double a30, a31, a32, a33;

    public void updateCoefficients (double[][] p) {
	a00 = p[1][1];
	a01 = -.5*p[1][0] + .5*p[1][2];
	a02 = p[1][0] - 2.5*p[1][1] + 2*p[1][2] - .5*p[1][3];
	a03 = -.5*p[1][0] + 1.5*p[1][1] - 1.5*p[1][2] + .5*p[1][3];
	a10 = -.5*p[0][1] + .5*p[2][1];
	a11 = .25*p[0][0] - .25*p[0][2] - .25*p[2][0] + .25*p[2][2];
	a12 = -.5*p[0][0] + 1.25*p[0][1] - p[0][2] + .25*p[0][3] + .5*p[2][0] - 1.25*p[2][1] + p[2][2] - .25*p[2][3];
	a13 = .25*p[0][0] - .75*p[0][1] + .75*p[0][2] - .25*p[0][3] - .25*p[2][0] + .75*p[2][1] - .75*p[2][2] + .25*p[2][3];
	a20 = p[0][1] - 2.5*p[1][1] + 2*p[2][1] - .5*p[3][1];
	a21 = -.5*p[0][0] + .5*p[0][2] + 1.25*p[1][0] - 1.25*p[1][2] - p[2][0] + p[2][2] + .25*p[3][0] - .25*p[3][2];
	a22 = p[0][0] - 2.5*p[0][1] + 2*p[0][2] - .5*p[0][3] - 2.5*p[1][0] + 6.25*p[1][1] - 5*p[1][2] + 1.25*p[1][3] + 2*p[2][0] - 5*p[2][1] + 4*p[2][2] - p[2][3] - .5*p[3][0] + 1.25*p[3][1] - p[3][2] + .25*p[3][3];
	a23 = -.5*p[0][0] + 1.5*p[0][1] - 1.5*p[0][2] + .5*p[0][3] + 1.25*p[1][0] - 3.75*p[1][1] + 3.75*p[1][2] - 1.25*p[1][3] - p[2][0] + 3*p[2][1] - 3*p[2][2] + p[2][3] + .25*p[3][0] - .75*p[3][1] + .75*p[3][2] - .25*p[3][3];
	a30 = -.5*p[0][1] + 1.5*p[1][1] - 1.5*p[2][1] + .5*p[3][1];
	a31 = .25*p[0][0] - .25*p[0][2] - .75*p[1][0] + .75*p[1][2] + .75*p[2][0] - .75*p[2][2] - .25*p[3][0] + .25*p[3][2];
	a32 = -.5*p[0][0] + 1.25*p[0][1] - p[0][2] + .25*p[0][3] + 1.5*p[1][0] - 3.75*p[1][1] + 3*p[1][2] - .75*p[1][3] - 1.5*p[2][0] + 3.75*p[2][1] - 3*p[2][2] + .75*p[2][3] + .5*p[3][0] - 1.25*p[3][1] + p[3][2] - .25*p[3][3];
	a33 = .25*p[0][0] - .75*p[0][1] + .75*p[0][2] - .25*p[0][3] - .75*p[1][0] + 2.25*p[1][1] - 2.25*p[1][2] + .75*p[1][3] + .75*p[2][0] - 2.25*p[2][1] + 2.25*p[2][2] - .75*p[2][3] - .25*p[3][0] + .75*p[3][1] - .75*p[3][2] + .25*p[3][3];
	

	//System.out.printf("\na02 = %f - 2.5*%f + 2*%f - .5*%f\n",p[1][0],p[1][1],p[1][2] ,p[1][3]);
	System.out.printf("\np00=%f p01=%f p02=%f p03=%f\n",p[0][0],p[0][1],p[0][2],p[0][3]);
	System.out.printf("p10=%f p11=%f p12=%f p13=%f\n",p[1][0],p[1][1],p[1][2],p[1][3]);
	System.out.printf("p20=%f p21=%f p22=%f p23=%f\n",p[2][0],p[2][1],p[2][2],p[2][3]);
	System.out.printf("p30=%f p31=%f p32=%f p33=%f\n",p[3][0],p[3][1],p[3][2],p[3][3]);
	
	System.out.printf("\na00=%f a01=%f a02=%f a03=%f\n",a00,a01,a02,a03);
	System.out.printf("a10=%f a11=%f a12=%f a13=%f\n",a10,a11,a12,a13);
	System.out.printf("a20=%f a21=%f a22=%f a23=%f\n",a20,a21,a22,a23);
	System.out.printf("a30=%f a31=%f a32=%f a33=%f\n",a30,a31,a32,a33);
    }

    public double getValue (double x, double y) {
	double x2 = x * x;
	double x3 = x2 * x;
	double y2 = y * y;
	double y3 = y2 * y;

	return (a00 + a01 * y + a02 * y2 + a03 * y3) +
	       (a10 + a11 * y + a12 * y2 + a13 * y3) * x +
	       (a20 + a21 * y + a22 * y2 + a23 * y3) * x2 +
	       (a30 + a31 * y + a32 * y2 + a33 * y3) * x3;
    }

    public static void main(String [] args)
    {
//	double p[][] = new double[][]{{1,3,3,4}, {7,2,3,4}, {1,6,3,6}, {2,5,7,2}};

	double p[][] = new double[][]{{25,  38,  51,  48},
{  23,  37,  51,  46},
{  33,  40,  48,  46},
{  39,  37,  41,  49}};


	CachedBicubicInterpolator cbi = new CachedBicubicInterpolator();
	cbi.updateCoefficients(p);
//	double ival = cbi.getValue(0.5, 0.7);
	double ival = cbi.getValue(0.011594,0.79712);
	System.out.printf("%f\n",ival);
    }
}
